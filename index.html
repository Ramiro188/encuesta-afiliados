<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tu Voz Tu Salud Per√∫ - √önete al Movimiento</title>
    
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome (para iconos) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- üé® ESTILOS CSS MEJORADOS --- */
        :root {
            --color-primario: #007BFF;
            --color-secundario: #00C6A7;
            --color-fondo: #f8f9fa;
            --color-tarjeta: #ffffff;
            --color-texto-principal: #212529;
            --color-texto-secundario: #495057;
            --color-borde: #dee2e6;
            --sombra-tarjeta: 0 5px 25px rgba(0, 0, 0, 0.07);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--color-fondo);
            /* Fondo con degradado sutil para darle "vida" */
            background-image: linear-gradient(180deg, #fdfdff 0%, #f8f9fa 100%);
            color: var(--color-texto-principal);
            margin: 0;
            line-height: 1.7;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Animaci√≥n para las tarjetas */
        .animated-card {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .animated-card.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* --- Header y Hero Section --- */
        .header {
            text-align: center;
            padding: 50px 20px 30px;
        }
        .header .logo {
            font-size: 2.8rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--color-primario), var(--color-secundario));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }
        .header .subtitle {
            font-size: 1.15rem;
            color: var(--color-texto-secundario);
            max-width: 600px;
            margin: 0 auto;
        }
        .participant-counter {
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: 25px;
            color: var(--color-primario);
            background-color: #e7f3ff;
            padding: 10px 20px;
            border-radius: 50px;
            display: inline-block;
        }

        /* --- Tarjetas (Estilo base) --- */
        .card {
            background-color: var(--color-tarjeta);
            border-radius: 16px;
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: var(--sombra-tarjeta);
            border: 1px solid var(--color-borde);
        }

        h2 {
            font-size: 1.8rem;
            text-align: center;
            margin-top: 0;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        h2 .icon {
            color: var(--color-primario);
        }
        
        /* --- Secci√≥n de Premios --- */
        .premios-banner {
            background: linear-gradient(45deg, var(--color-primario), var(--color-secundario));
            color: white;
            text-align: center;
            padding: 25px;
        }
        .premios-banner h2 {
            margin: 0;
            font-size: 1.4rem;
            color: white;
        }
        .premios-banner .icon {
            color: white;
        }

        /* --- Formulario Mejorado --- */
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        .form-group input {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--color-borde);
            border-radius: 10px;
            font-size: 1.1rem;
            font-family: 'Poppins', sans-serif;
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .form-group input:focus {
            outline: none;
            border-color: var(--color-primario);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
        }
        .btn-submit {
            width: 100%;
            padding: 16px;
            background-color: var(--color-primario);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn-submit:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }
        .btn-submit:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* --- Dashboard de Afiliado --- */
        .dashboard { text-align: center; }
        .dashboard-intro {
            font-size: 1.1rem;
            margin-bottom: 25px;
        }
        .referral-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
        }
        .stat-box {
            background-color: var(--color-fondo);
            padding: 15px 25px;
            border-radius: 10px;
        }
        .stat-box .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--color-primario);
        }
        .stat-box .label { font-size: 0.9rem; color: var(--color-texto-secundario); }
        
        .referral-link-container {
            background-color: #e7f3ff;
            padding: 15px;
            border-radius: 10px;
            border: 1px dashed var(--color-primario);
            margin: 25px 0;
            word-wrap: break-word;
        }
        #user-referral-link { font-weight: 600; color: var(--color-primario); }
        .dashboard-actions {
            display: flex; flex-direction: column; gap: 15px;
        }
        .btn-action {
            padding: 15px; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; border: none;
        }
        #survey-btn { background-color: var(--color-secundario); color: white; }
        #survey-btn:hover { background-color: #009e86; }
        #copy-btn { background-color: transparent; color: var(--color-primario); border: 2px solid var(--color-primario); }
        #copy-btn:hover { background-color: var(--color-primario); color: white; }
        #whatsapp-btn { background-color: #25D366; color: white; display: flex; align-items: center; justify-content: center; gap: 10px; }
        #whatsapp-btn:hover { background-color: #1EBE57; }

        /* --- Ranking --- */
        .ranking-item {
            display: flex; align-items: center; padding: 15px; border-bottom: 1px solid var(--color-borde);
        }
        .ranking-item:last-child { border-bottom: none; }
        .rank-position { font-size: 1.5rem; font-weight: 700; color: var(--color-primario); margin-right: 20px; width: 40px; text-align: center; }
        .rank-name { font-weight: 600; flex-grow: 1; }
        .rank-count { font-weight: 600; color: var(--color-secundario); }
        .current-user-rank { margin-top: 25px; padding: 20px; background-color: #e7f3ff; border-radius: 10px; border-left: 5px solid var(--color-primario); font-weight: 600; text-align: center; }
        
        /* --- Temporizador --- */
        #timer { display: flex; justify-content: space-around; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        .timer-box { background-color: var(--color-tarjeta); padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); min-width: 80px; text-align: center; }
        .timer-value { font-size: 2.5rem; font-weight: 700; color: var(--color-primario); }
        .timer-label { font-size: 0.9rem; color: var(--color-texto-secundario); margin-top: 5px; }

        /* --- Footer --- */
        .footer {
            text-align: center;
            padding: 30px 20px;
            color: var(--color-texto-secundario);
            font-size: 0.9rem;
            margin-top: 20px;
        }
        .footer a {
            color: var(--color-primario);
            font-weight: 600;
            text-decoration: none;
        }

        .hidden { display: none; }
    </style>
</head>
<body>

    <header class="header">
        <div class="logo">Tu Voz Tu Salud</div>
        <p class="subtitle">La campa√±a que une a todo el Per√∫ para exigir un sistema de salud digno y eficiente. Tu voz es la herramienta m√°s poderosa.</p>
        <div class="participant-counter">
            <i class="fa-solid fa-users"></i> Ya somos <strong id="live-counter">50,123</strong> peruanos cambiando la salud
        </div>
    </header>

    <div class="container">

        <!-- Banner de Premios (con animaci√≥n) -->
        <div class="premios-banner card animated-card">
            <h2><i class="icon fa-solid fa-trophy"></i>Gana por participar y por referir</h2>
            <p>Participa del sorteo de <strong>2 premios de S/10</strong> solo por unirte. Adem√°s, compite por el gran premio de <strong>S/100</strong> para quien consiga m√°s referidos.</p>
        </div>

        <!-- Formulario (o Dashboard si ya est√° registrado) -->
        <div id="registro-card" class="card animated-card">
            <h2><i class="icon fa-solid fa-pen-to-square"></i>√önete en 30 segundos</h2>
            <form id="referralForm">
                <div class="form-group">
                    <label for="userName">Tu Nombre Completo</label>
                    <input type="text" id="userName" name="userName" placeholder="Escribe tu nombre aqu√≠" required>
                </div>
                <div class="form-group">
                    <label for="userEmail">Tu Correo Electr√≥nico</label>
                    <input type="email" id="userEmail" name="userEmail" placeholder="Para contactarte si ganas" required>
                </div>
                <div class="form-group">
                    <label for="userYape">Tu N√∫mero de Celular o Yape</label>
                    <input type="tel" id="userYape" name="userYape" placeholder="Para enviarte los premios" required>
                </div>
                <!-- Campo oculto para el referidor, se rellena con JS -->
                <input type="hidden" id="referrerId" name="referrerId">
                
                <button type="submit" id="submit-btn" class="btn-submit">
                    <span id="btn-text">¬°Unirme ahora y participar!</span>
                    <div id="spinner" class="spinner hidden"></div>
                </button>
                <div id="form-message" style="margin-top: 15px; text-align: center; color: red;"></div>
            </form>
        </div>

        <!-- Dashboard de Referidos (Oculto inicialmente) -->
        <div id="dashboard-card" class="card animated-card hidden">
            <h2><i class="icon fa-solid fa-rocket"></i>¬°Bienvenido/a, <span id="dashboard-username"></span>!</h2>
            <p class="dashboard-intro">Ya eres parte del cambio. Ahora tienes dos misiones:</p>
            
            <a href="#URL_DE_LA_ENCUESTA" target="_blank" id="survey-btn" class="btn-action">1. Responder la Encuesta Ahora</a>
            
            <div style="text-align:center; margin: 20px 0; font-weight: bold; color: var(--color-texto-secundario);">Y/O</div>

            <p>2. Invita a m√°s personas y sube en el ranking:</p>

            <div class="referral-stats">
                <div class="stat-box">
                    <div id="user-referrals-count" class="value">0</div>
                    <div class="label">Tus Referidos</div>
                </div>
            </div>
            
            <div class="referral-link-container">
                <span id="user-referral-link"></span>
            </div>
            
            <div class="dashboard-actions">
                <button id="copy-btn" class="btn-action"><i class="fa-solid fa-copy"></i> Copiar mi Enlace</button>
                <button id="whatsapp-btn" class="btn-action"><i class="fa-brands fa-whatsapp"></i> Compartir por WhatsApp</button>
            </div>
        </div>

        <!-- Ranking de Referidos -->
        <div id="ranking-card" class="card animated-card">
            <h2><i class="icon fa-solid fa-ranking-star"></i>Ranking de Impacto</h2>
            <ol id="ranking-list" class="ranking-list" style="list-style: none; padding: 0;">
                <!-- Ranking generado con JS -->
            </ol>
            <div id="current-user-rank" class="current-user-rank hidden">
                <!-- Posici√≥n del usuario actual -->
            </div>
        </div>
        
        <!-- Temporizador -->
        <div id="countdown-card" class="card animated-card">
            <h2><i class="icon fa-solid fa-clock"></i>Cierre de la campa√±a y sorteo</h2>
            <div id="timer">
                <!-- Temporizador generado con JS -->
            </div>
        </div>

    </div>

    <footer class="footer">
        Un proyecto de <a href="https://clinic-ios.com" target="_blank">Clinic IOS</a> para la campa√±a nacional <br><strong>Tu Voz Tu Salud Per√∫</strong>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- SELECTORES DE ELEMENTOS ---
        const referralForm = document.getElementById('referralForm');
        const registroCard = document.getElementById('registro-card');
        const dashboardCard = document.getElementById('dashboard-card');
        const formMessage = document.getElementById('form-message');
        const referrerIdInput = document.getElementById('referrerId');
        const submitBtn = document.getElementById('submit-btn');
        const btnText = document.getElementById('btn-text');
        const spinner = document.getElementById('spinner');

        // --- L√ìGICA DE ANIMACIONES AL SCROLLEAR ---
        const animatedCards = document.querySelectorAll('.animated-card');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });
        animatedCards.forEach(card => observer.observe(card));

        // --- NUEVA FUNCI√ìN: CONTADOR DE PARTICIPANTES ---
        const liveCounter = document.getElementById('live-counter');
        let currentCount = 50123;
        setInterval(() => {
            currentCount += Math.floor(Math.random() * 3) + 1;
            liveCounter.textContent = currentCount.toLocaleString('es-PE');
        }, 2500); // Aumenta cada 2.5 segundos

        // --- L√ìGICA DE FORMULARIO MEJORADA ---
        const urlParams = new URLSearchParams(window.location.search);
        const refIdFromUrl = urlParams.get('ref');
        if (refIdFromUrl) {
            referrerIdInput.value = refIdFromUrl;
        }

        referralForm.addEventListener('submit', function(event) {
            event.preventDefault();
            formMessage.textContent = '';
            
            // Feedback visual al usuario
            submitBtn.disabled = true;
            btnText.textContent = 'Procesando...';
            spinner.classList.remove('hidden');

            const formData = new FormData(referralForm);
            
            // Generaci√≥n autom√°tica del ID √∫nico del usuario
            const userName = formData.get('userName');
            const uniqueId = userName.split(' ')[0].substring(0, 4).toUpperCase() + Math.random().toString(36).substring(2, 6).toUpperCase();
            formData.append('userId', uniqueId);

            const data = Object.fromEntries(formData.entries());

            console.log("Datos listos para enviar:", data);
            
            // --- üîΩ AQU√ç VA LA CONEXI√ìN CON GOOGLE APPS SCRIPT üîΩ ---
            // Simulaci√≥n de env√≠o con un retraso para mostrar el spinner
            setTimeout(() => {
                /*
                const scriptURL = 'TU_URL_DE_GOOGLE_APPS_SCRIPT';
                fetch(scriptURL, { method: 'POST', body: formData })
                    .then(response => {
                        console.log('Success!', response);
                        showDashboard(data);
                        localStorage.setItem('tvtsUser', JSON.stringify(data));
                    })
                    .catch(error => {
                        console.error('Error!', error.message);
                        formMessage.textContent = 'Hubo un error al registrar. Int√©ntalo de nuevo.';
                    })
                    .finally(() => {
                         // Reactivar el bot√≥n sin importar el resultado
                        submitBtn.disabled = false;
                        btnText.textContent = '¬°Unirme ahora y participar!';
                        spinner.classList.add('hidden');
                    });
                */
                
                // Demo sin backend:
                showDashboard(data);
                localStorage.setItem('tvtsUser', JSON.stringify(data));
                
            }, 1500); // 1.5 segundos de simulaci√≥n
        });
        
        function showDashboard(userData) {
            registroCard.classList.add('hidden');
            dashboardCard.classList.remove('hidden');
            document.getElementById('current-user-rank').classList.remove('hidden');

            const domain = window.location.origin + window.location.pathname;
            const referralLink = `${domain}?ref=${userData.userId}`;

            document.getElementById('dashboard-username').textContent = userData.userName.split(' ')[0];
            document.getElementById('user-referral-link').textContent = referralLink;

            // L√≥gica de botones del dashboard
            document.getElementById('copy-btn').addEventListener('click', () => {
                navigator.clipboard.writeText(referralLink).then(() => {
                    const btn = document.getElementById('copy-btn');
                    btn.innerHTML = '<i class="fa-solid fa-check"></i> ¬°Copiado!';
                    setTimeout(() => { btn.innerHTML = '<i class="fa-solid fa-copy"></i> Copiar mi Enlace'; }, 2000);
                });
            });

            document.getElementById('whatsapp-btn').addEventListener('click', () => {
                const message = encodeURIComponent(`¬°Hola! S√∫mate a "Tu Voz Tu Salud Per√∫", la campa√±a para transformar la salud del pa√≠s. Reg√≠strate con mi enlace, responde la encuesta y participa por premios: ${referralLink}`);
                window.open(`https://api.whatsapp.com/send?text=${message}`, '_blank');
            });
            
            // **IMPORTANTE**: Cambia "#URL_DE_LA_ENCUESTA" por el enlace real
            document.getElementById('survey-btn').href = "https://example.com/encuesta-de-salud";


            // Simulaci√≥n de estad√≠sticas del usuario
            document.getElementById('user-referrals-count').textContent = "5"; // Simulado
            document.getElementById('current-user-rank').innerHTML = `¬°Est√°s en el <strong>puesto 35 de ${currentCount.toLocaleString('es-PE')}</strong>! Sigue compartiendo para subir.`;
        }

        // --- MANTENER SESI√ìN DEL USUARIO ---
        const savedUser = localStorage.getItem('tvtsUser');
        if (savedUser) {
            showDashboard(JSON.parse(savedUser));
        }

        // --- RANKING SIMULADO ---
        const rankingList = document.getElementById('ranking-list');
        const topReferrers = [
            { name: 'Juan C.', count: 87 }, { name: 'Sofia V.', count: 72 }, { name: 'Carlos P.', count: 55 },
            { name: 'Ana G.', count: 48 }, { name: 'Luis M.', count: 41 }, { name: 'Valeria R.', count: 35 },
            { name: 'Diego S.', count: 29 }, { name: 'Camila T.', count: 22 }, { name: 'Mateo F.', count: 18 },
            { name: 'Luciana H.', count: 15 },
        ];
        rankingList.innerHTML = topReferrers.map((user, index) => `
            <li class="ranking-item">
                <span class="rank-position">#${index + 1}</span>
                <span class="rank-name">${user.name}</span>
                <span class="rank-count">${user.count} referidos</span>
            </li>
        `).join('');

        // --- TEMPORIZADOR ---
        const countdownDate = new Date("July 28, 2024 23:59:59").getTime();
        const timerContainer = document.getElementById('timer');

        const timerInterval = setInterval(() => {
            const now = new Date().getTime();
            const distance = countdownDate - now;

            if (distance < 0) {
                clearInterval(timerInterval);
                timerContainer.innerHTML = "<h3 style='color:var(--color-secundario);'>¬°La campa√±a ha finalizado! Anunciaremos a los ganadores pronto.</h3>";
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            
            timerContainer.innerHTML = `
                <div class="timer-box"><span class="timer-value">${String(days).padStart(2, '0')}</span><span class="timer-label">D√≠as</span></div>
                <div class="timer-box"><span class="timer-value">${String(hours).padStart(2, '0')}</span><span class="timer-label">Horas</span></div>
                <div class="timer-box"><span class="timer-value">${String(minutes).padStart(2, '0')}</span><span class="timer-label">Minutos</span></div>
                <div class="timer-box"><span class="timer-value">${String(seconds).padStart(2, '0')}</span><span class="timer-label">Segundos</span></div>
            `;
        }, 1000);
    });
    </script>
</body>
</html>
